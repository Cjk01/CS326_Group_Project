{"version":3,"file":"matchers-jestonly.js","sources":["../../src/jest/matchers/to-match-codeframe.ts","../../src/jest/matchers/to-match-inline-codeframe.ts"],"sourcesContent":["import kleur from \"kleur\";\nimport { toMatchSnapshot } from \"jest-snapshot\";\nimport { codeframe, type CodeframeOptions } from \"../../formatters/codeframe\";\nimport { type Report } from \"../../reporter\";\nimport {\n\ttype MatcherContext,\n\ttype MatcherResult,\n\ttype MaybeAsyncCallback,\n\tdiverge,\n} from \"../utils\";\nimport { getResults } from \"./get-results\";\n\nconst options: CodeframeOptions = {\n\tshowLink: false,\n\tshowSummary: false,\n\tshowSelector: true,\n};\n\nfunction createMatcher(): MaybeAsyncCallback<Report | string, [Array<string | object>]> {\n\tfunction toMatchCodeframe(\n\t\tthis: MatcherContext,\n\t\tactual: Report | string,\n\t\t...rest: Array<string | object>\n\t): MatcherResult {\n\t\t/* istanbul ignore next: cant figure out when this would be unset */\n\t\tconst filename = this.testPath ?? \"inline\";\n\t\tconst results = getResults(filename, actual);\n\t\tconst enabled = kleur.enabled;\n\t\tkleur.enabled = false;\n\t\tconst snapshot = codeframe(results, options).replace(/\\s+$/gm, \"\");\n\t\tkleur.enabled = enabled;\n\n\t\t/* eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call --\n\t\t * the implementation works but the declarations doesn't allow it */\n\t\treturn (toMatchSnapshot as any).call(this, snapshot, ...rest);\n\t}\n\treturn diverge(toMatchCodeframe);\n}\n\nexport { createMatcher as toMatchCodeframe };\n","import kleur from \"kleur\";\nimport { toMatchInlineSnapshot } from \"jest-snapshot\";\nimport { codeframe, type CodeframeOptions } from \"../../formatters/codeframe\";\nimport { type Report } from \"../../reporter\";\nimport { type MatcherContext, type MatcherResult, isThenable } from \"../utils\";\nimport { getResults } from \"./get-results\";\n\nconst options: CodeframeOptions = {\n\tshowLink: false,\n\tshowSummary: false,\n\tshowSelector: true,\n};\n\nfunction toMatchInlineCodeframeImpl(\n\tcontext: MatcherContext,\n\tactual: Report | string,\n\t...rest: Array<string | object>\n): MatcherResult {\n\t/* istanbul ignore next: cant figure out when this would be unset */\n\tconst filename = context.testPath ?? \"inline\";\n\tconst results = getResults(filename, actual);\n\tconst enabled = kleur.enabled;\n\tkleur.enabled = false;\n\tconst snapshot = codeframe(results, options).replace(/\\s+$/gm, \"\");\n\tkleur.enabled = enabled;\n\n\t/* eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call --\n\t * the implementation works but the declarations doesn't allow it */\n\treturn (toMatchInlineSnapshot as any).call(context, snapshot, ...rest);\n}\n\ntype ToMatchInlineCodeframeMatcher = (\n\tthis: MatcherContext,\n\tactual: Report | Promise<Report> | string,\n\t...rest: Array<string | object>\n) => MatcherResult | Promise<MatcherResult>;\n\nfunction createMatcher(): ToMatchInlineCodeframeMatcher {\n\tfunction toMatchInlineCodeframe(\n\t\tthis: MatcherContext,\n\t\tactual: Report | Promise<Report> | string,\n\t\t...rest: Array<string | object>\n\t): MatcherResult | Promise<MatcherResult> {\n\t\tconst context = {\n\t\t\t...this,\n\n\t\t\t/* Capture the original stack frames as they are needed by \"jest-snapshot\"\n\t\t\t * to determine where to write the inline snapshots. When resolving the\n\t\t\t * promise the original stack frames are lost and the snapshot will be\n\t\t\t * written in this files instaed. */\n\t\t\terror: new Error(),\n\t\t};\n\n\t\tif (isThenable(actual)) {\n\t\t\treturn actual.then((resolved) => toMatchInlineCodeframeImpl(context, resolved, ...rest));\n\t\t} else {\n\t\t\treturn toMatchInlineCodeframeImpl(context, actual, ...rest);\n\t\t}\n\t}\n\n\treturn toMatchInlineCodeframe;\n}\n\nexport { createMatcher as toMatchInlineCodeframe };\n"],"names":["options","createMatcher","getResults","kleur","codeframe","toMatchSnapshot","diverge","toMatchInlineSnapshot","isThenable"],"mappings":";;;;;;;;;;;;AAYA,MAAMA,SAA4B,GAAA;AAAA,EACjC,QAAU,EAAA,KAAA;AAAA,EACV,WAAa,EAAA,KAAA;AAAA,EACb,YAAc,EAAA,IAAA;AACf,CAAA,CAAA;AAEA,SAASC,eAA+E,GAAA;AACvF,EAAS,SAAA,gBAAA,CAER,WACG,IACa,EAAA;AAEhB,IAAM,MAAA,QAAA,GAAW,KAAK,QAAY,IAAA,QAAA,CAAA;AAClC,IAAM,MAAA,OAAA,GAAUC,mBAAW,CAAA,QAAA,EAAU,MAAM,CAAA,CAAA;AAC3C,IAAA,MAAM,UAAUC,sBAAM,CAAA,OAAA,CAAA;AACtB,IAAAA,sBAAA,CAAM,OAAU,GAAA,KAAA,CAAA;AAChB,IAAA,MAAM,WAAWC,cAAU,CAAA,OAAA,EAASJ,SAAO,CAAE,CAAA,OAAA,CAAQ,UAAU,EAAE,CAAA,CAAA;AACjE,IAAAG,sBAAA,CAAM,OAAU,GAAA,OAAA,CAAA;AAIhB,IAAA,OAAQE,4BAAwB,CAAA,IAAA,CAAK,IAAM,EAAA,QAAA,EAAU,GAAG,IAAI,CAAA,CAAA;AAAA,GAC7D;AACA,EAAA,OAAOC,qBAAQ,gBAAgB,CAAA,CAAA;AAChC;;AC9BA,MAAM,OAA4B,GAAA;AAAA,EACjC,QAAU,EAAA,KAAA;AAAA,EACV,WAAa,EAAA,KAAA;AAAA,EACb,YAAc,EAAA,IAAA;AACf,CAAA,CAAA;AAEA,SAAS,0BAAA,CACR,OACA,EAAA,MAAA,EAAA,GACG,IACa,EAAA;AAEhB,EAAM,MAAA,QAAA,GAAW,QAAQ,QAAY,IAAA,QAAA,CAAA;AACrC,EAAM,MAAA,OAAA,GAAUJ,mBAAW,CAAA,QAAA,EAAU,MAAM,CAAA,CAAA;AAC3C,EAAA,MAAM,UAAUC,sBAAM,CAAA,OAAA,CAAA;AACtB,EAAAA,sBAAA,CAAM,OAAU,GAAA,KAAA,CAAA;AAChB,EAAA,MAAM,WAAWC,cAAU,CAAA,OAAA,EAAS,OAAO,CAAE,CAAA,OAAA,CAAQ,UAAU,EAAE,CAAA,CAAA;AACjE,EAAAD,sBAAA,CAAM,OAAU,GAAA,OAAA,CAAA;AAIhB,EAAA,OAAQI,kCAA8B,CAAA,IAAA,CAAK,OAAS,EAAA,QAAA,EAAU,GAAG,IAAI,CAAA,CAAA;AACtE,CAAA;AAQA,SAAS,aAA+C,GAAA;AACvD,EAAS,SAAA,sBAAA,CAER,WACG,IACsC,EAAA;AACzC,IAAA,MAAM,OAAU,GAAA;AAAA,MACf,GAAG,IAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAMH,KAAA,EAAO,IAAI,KAAM,EAAA;AAAA,KAClB,CAAA;AAEA,IAAI,IAAAC,uBAAA,CAAW,MAAM,CAAG,EAAA;AACvB,MAAO,OAAA,MAAA,CAAO,KAAK,CAAC,QAAA,KAAa,2BAA2B,OAAS,EAAA,QAAA,EAAU,GAAG,IAAI,CAAC,CAAA,CAAA;AAAA,KACjF,MAAA;AACN,MAAA,OAAO,0BAA2B,CAAA,OAAA,EAAS,MAAQ,EAAA,GAAG,IAAI,CAAA,CAAA;AAAA,KAC3D;AAAA,GACD;AAEA,EAAO,OAAA,sBAAA,CAAA;AACR;;;;;"}